# Домашнее задание к занятию 3 `«Резервное копирование»` - `Евгений Головенко`

---

### Задание 1

- Составьте команду rsync, которая позволяет создавать зеркальную копию домашней директории пользователя в директорию `/tmp/backup`
- Необходимо исключить из синхронизации все директории, начинающиеся с точки (скрытые)
- Необходимо сделать так, чтобы rsync подсчитывал хэш-суммы для всех файлов, даже если их время модификации и размер идентичны в источнике и приемнике.
- На проверку направить скриншот с командой и результатом ее выполнения

### Решение 1

<img width="622" height="292" alt="Capture1" src="https://github.com/user-attachments/assets/3823da93-d765-4508-b3e0-e871e30b2b7d" />

Что эта команда должна делать:

`-a              ` — архивный режим (сохраняет права, владельца, рекурсивно копирует и т.д.)

`-v              ` — подробный вывод (чтобы было видно процесс)

`--delete        ` — удаляет на приёмнике файлы, которых больше нет в источнике (зеркальная копия)

`--checksum      ` — сравнивает файлы по контрольным суммам, а не по дате/размеру

`--exclude='.*'  ` — исключает скрытые файлы и директории (начинающиеся с точки)

`~               ` — домашняя директория текущего пользователя

`/tmp/backup/    ` — путь, куда копируем

Сравнение:

<img width="675" height="596" alt="Capture2" src="https://github.com/user-attachments/assets/b6a1d517-2d93-4fd4-ad8c-7eca2245dcfd" />

---

### Задание 2

- Написать скрипт и настроить задачу на регулярное резервное копирование домашней директории пользователя с помощью rsync и cron.
- Резервная копия должна быть полностью зеркальной
- Резервная копия должна создаваться раз в день, в системном логе должна появляться запись об успешном или неуспешном выполнении операции
- Резервная копия размещается локально, в директории `/tmp/backup`
- На проверку направить файл crontab и скриншот с результатом работы утилиты.

### Решение 2

`backup_home.sh`

```
#!/bin/bash

SRC="$HOME"
DEST="/tmp/backup"
LOGTAG="backup_home"

# Creating backup directory
mkdir -p "$DEST"

# Running rsync
rsync -av --delete --checksum --exclude='.*' "$SRC"/ "$DEST"/
STATUS=$?

# Checking results and logging
if [ $STATUS -eq 0 ]; then
    logger -t "$LOGTAG" "Calm down and relax, bro! Backup succesfull."
else
    logger -t "$LOGTAG" "Backup error - code $STATUS"
fi
```

Делаем скрипт исполняемым:

`sudo chmod +x /home/eugen/netology/backup_home.sh`

Добавляем задачу в cron

`0 2 * * * /home/eugen/netology/backup_home.sh`

Проверяем работу скрипта:

<img width="652" height="515" alt="Capture4" src="https://github.com/user-attachments/assets/b7c056c0-ce45-4ce8-be26-c93d17f25cba" />
